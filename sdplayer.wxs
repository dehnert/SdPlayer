<?xml version="1.0"?>
<?define ProductVersion = "2.00.3"?>
<?define ProductUpgradeCode = "91d4a63a-bdcb-4aa3-8d4d-ecaeb7da8e62"?>
<!-- Based on template at https://www.codeproject.com/Tips/105638/A-quick-introduction-Create-an-MSI-installer-with -->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
   <Product Id="*" UpgradeCode="$(var.ProductUpgradeCode)"
            Name="SdPlayer" Version="$(var.ProductVersion)" Manufacturer="SdPlayer" Language="1033">
      <Package InstallerVersion="200" Compressed="yes" Platform="x64" Comments="Windows Installer Package"/>
      <Media Id="1" Cabinet="product.cab" EmbedCab="yes"/>
      <Icon Id="ProductIcon" SourceFile="Music.ico"/>
      <Property Id="ARPPRODUCTICON" Value="ProductIcon"/>
      <Property Id="ARPHELPLINK" Value="https://www.krubow.com/Downloads/SdPlayer200/sdplayer.html"/>
      <Property Id="ARPURLINFOABOUT" Value="https://www.krubow.com/Downloads.htm#dlsdplayer"/>
      <Property Id="ARPNOREPAIR" Value="1"/>
      <Property Id="ARPNOMODIFY" Value="1"/>
      <Upgrade Id="$(var.ProductUpgradeCode)">
         <UpgradeVersion Minimum="$(var.ProductVersion)" OnlyDetect="yes" Property="NEWERVERSIONDETECTED"/>
         <UpgradeVersion Minimum="0.0.0" Maximum="$(var.ProductVersion)" IncludeMinimum="yes" IncludeMaximum="no"
                         Property="OLDERVERSIONBEINGUPGRADED"/>
      </Upgrade>
      <Condition Message="A newer version of this software is already installed.">NOT NEWERVERSIONDETECTED</Condition>

      <Directory Id="TARGETDIR" Name="SourceDir">
         <Directory Id="ProgramFiles64Folder">
            <Directory Id="INSTALLDIR" Name="SdPlayer">
            </Directory>
         </Directory>

         <Directory Id="ProgramMenuFolder">
            <Directory Id="ProgramMenuSubfolder" Name="SdPlayer">
               <Component Id="ApplicationShortcuts" Guid="2774770d-7c17-41b3-8b2f-423b4c3228f1">
                  <Shortcut Id="ApplicationShortcut1" Name="SdPlayer" Description="Music player for square dance tape groups"
                            Target="[INSTALLDIR]SdPlayer.exe" WorkingDirectory="INSTALLDIR"/>
                  <RegistryValue Root="HKCU" Key="Software\SdPlayer\SdPlayer"
                            Name="installed" Type="integer" Value="1" KeyPath="yes"/>
                  <RemoveFolder Id="ProgramMenuSubfolder" On="uninstall"/>
               </Component>
            </Directory>
         </Directory>
      </Directory>

      <InstallExecuteSequence>
         <RemoveExistingProducts After="InstallValidate"/>
      </InstallExecuteSequence>

      <Feature Id="DefaultFeature" Level="1">
         <ComponentGroupRef Id="InstallDirComps"/>
         <ComponentRef Id="ApplicationShortcuts"/>
      </Feature>

      <!-- Allow running SdPlayer immediately upon install -->
      <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" Value="Launch SdPlayer" />
      <Property Id="WixShellExecTarget" Value="[INSTALLDIR]SdPlayer.exe" />
      <CustomAction Id="LaunchApplication" BinaryKey="WixCA" DllEntry="WixShellExec" Impersonate="yes" />

      <UI>
        <UIRef Id="WixUI_Minimal" />
        <Publish Dialog="ExitDialog"
                     Control="Finish"
                     Event="DoAction"
                     Value="LaunchApplication">WIXUI_EXITDIALOGOPTIONALCHECKBOX = 1 and NOT Installed</Publish>
      </UI>
   </Product>
</Wix>
